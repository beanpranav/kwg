<% if user_signed_in? %>

	<% if current_user.user_type == "researcher" %>
		
		<div class="col-xs-12 col-sm-8 col-sm-offset-2">
			<div class="secondary-nav secondary-nav-invert">
				<i class="fa fa-2x fa-rocket content-list-icon-primary pull-left"></i>
				<h2 class="font-invert"><b>Hi <%= current_user.first_name %>!</b></h2>
				<h3 class="font-invert">As a researcher you have hosted <%= pluralize( @games_created.count, 'game' ) %>.</h3>
			</div>

			<div class="content-container">
				<div class="panel-secondary">
	  		  <div class="panel-title">
	  			  Current: <%= pluralize( @games_in_progress.count, 'Game' ) %>
	  		  </div>
	  		</div>

	  		<div class="panel-body">

	  			<table class="table table-condensed table-hover">
	  			  <thead>
	  			    <tr>
	  			      <th>Created on</th>
	  			      <th>Session Name</th>
	  			      <th>Codename</th>
	  			      <th>MTM Type</th>
	  			      <th colspan="1">Condition</th>
	  			      <th colspan="1"></th>
	  			    </tr>
	  			  </thead>

	  			  <tbody>
	  			    <% @games_in_progress.sort_by(&:created_at).reverse.each.with_index do |game, i| %>
	  			      <tr>
	  			        <td><%= game.created_at.strftime("%b %d, %Y") %></td>
	  			        <td class="one-line-cell"><%= game.session_name %></td>
	  			        <td><%= game.game_codename %></td>
	  			        <td><%= $GAME_TYPES_LOOKUP[game.game_type][:name] %></td>
	  			        <td><%= if game.access_treatement then "Treatment" else "Control" end %></td>
	  			        <td class="center <%= if game.game_status > 0 then "panel-green" elsif game.game_status == 0 then "panel-orange" end %>"><a href="<%= game_path(game) %>"><i class="fa fa-arrow-right"></a></td>
	  			      </tr>
	  			    <% end %>
	  			  </tbody>
	  			</table>

	  			<%= link_to controller: "games", action: "new", user_id: current_user.id do %>
						<div class="center col-sm-6 col-sm-offset-3">
		          <button type="button" class="btn btn-block btn-green">+ ADD GAME</button>
		        </div>
					<% end %>

	  		</div>
			</div>

			<div class="content-container">
				<div class="panel-secondary">
	  		  <div class="panel-title">
	  			  Completed: <%= pluralize( @games_completed.count, 'Game' ) %>
	  		  </div>
	  		</div>

	  		<div class="panel-body">

	  			<table class="table table-condensed table-hover">
	  			  <thead>
	  			    <tr>
	  			      <th>Created on</th>
	  			      <th>Session Name</th>
	  			      <th>Codename</th>
	  			      <th>MTM Type</th>
	  			      <th colspan="1">Condition</th>
	  			      <th colspan="1"></th>
	  			    </tr>
	  			  </thead>

	  			  <tbody>
	  			    <% @games_completed.sort_by(&:created_at).reverse.each.with_index do |game, i| %>
	  			      <tr>
	  			        <td><%= game.created_at.strftime("%b %d, %Y") %></td>
	  			        <td class="one-line-cell"><%= game.session_name %></td>
	  			        <td><%= game.game_codename %></td>
	  			        <td><%= $GAME_TYPES_LOOKUP[game.game_type][:name] %></td>
	  			        <td><%= if game.access_treatement then "Treatment" else "Control" end %></td>
	  			        <td><a href="<%= game_path(game) %>"><i class="fa fa-arrow-right"></a></td>
	  			      </tr>
	  			    <% end %>
	  			  </tbody>
	  			</table>

	  		</div>
			</div>
		</div>
		
	<% else %>
		
		<div class="col-xs-12 col-sm-8 col-sm-offset-2">
			<div class="secondary-nav secondary-nav-invert">
				<i class="fa fa-2x fa-rocket content-list-icon-primary pull-left"></i>
				<h2 class="font-invert"><b>Hi <%= current_user.first_name %>!</b></h2>
				<h3 class="font-invert">As a participant, you have played <%= pluralize( current_user.games.count, 'game' ) %>.</h3>
			</div>
		
  		<!-- 			= link_to controller: "games", action: "new", user_id: current_user.id do %>
				<div class="game-card supress-a col-sm-4 row">
					Ready to Play
				</div>
			 end %> -->

			<div class="content-container">
				<div class="panel-secondary">
	  		  <div class="panel-title">
	  			  Current Status
	  		  </div>
	  		</div>

	  		<div class="panel-body">

	  			<div class="h-primary">PLAYER STATUS: <%= current_user.user_status.upcase %></div>
					
					<% if current_user.user_status == "offline" %>
						<h3 class="center">click "join" when you are ready to play</h3>	
		  			<%= link_to activate_user_path(user_id: current_user.id), method: :post do %>
							<div class="center col-sm-6 col-sm-offset-3 button-padding">
			          <button type="button" class="btn btn-block btn-green">JOIN A GAME</button>
			        </div>
						<% end %>

					<% elsif current_user.user_status == "active" %>
						<h3 class="center">please wait to get assigned</h3>	
						<div class="center col-sm-6 col-sm-offset-3 button-padding">
		          <button type="button" class="btn btn-block btn-orange active">LOOKING FOR GAME ...</button>
		        </div>

					<% else %>
						<h3 class="center">game in session</h3>	
		  			<%= link_to player_path(@current_game_screen) do %>
							<div class="center col-sm-6 col-sm-offset-3 button-padding">
			          <button type="button" class="btn btn-block btn-green">GO TO GAME</button>
			        </div>
						<% end %>

					<% end %>


			  </div>
			</div>

			<% if current_user.players.count > 0 %>

			  <div class="content-container">
			    <div class="panel-secondary">
			      <div class="panel-title">
			        Game Listing
			      </div>
			    </div>

			    <div class="panel-body">
					<!-- GAME LISTINGS -->
		  			<table class="table table-condensed table-hover">
		  			  <thead>
		  			    <tr>
		  			      <th>Played on</th>
		  			      <th>Codename</th>
		  			      <th>Game length</th>
		  			      <th colspan="1">Status</th>
		  			      <th colspan="1"></th>
		  			    </tr>
		  			  </thead>

		  			  <tbody>
		  			    <% current_user.players.sort_by(&:created_at).reverse.each.with_index do |p| %>
		  			      <tr>
		  			        <td><%= p.game.updated_at.strftime("%b %d, %Y") %></td>
		  			        <td><%= p.game.game_codename %></td>
		  			        <td><%= p.game.game_length %> months</td>
		  			        <td><%= if p.game.game_status <= 0 then "Not Started" elsif p.game.game_status > p.game.game_length then "Completed" else "Incomplete" end %></td>
		  			        <td class="center <%= if p.game.game_status <= 0 then "panel-orange" elsif p.game.game_status > p.game.game_length then "" else "panel-green" end %>"><a href="<%= player_path(p) %>"><i class="fa fa-arrow-right"></a></td>
		  			      </tr>
		  			    <% end %>
		  			  </tbody>
		  			</table>

		  		</div>

				</div>
			<% end %>

		</div>

	<% end %>

<% else %>
	
	<h2>Welcome Participants!</h2>
	<p>If you already have an account <a href="/login">login here</a>, else <a href="/create_account">create your account</a>.</p>
	<br>
	<br>
	<br>
	<h2>Demo screenshots</h2>
	<p><a href="/demo_screenshots">MTM player view</a></p>

<% end %>
