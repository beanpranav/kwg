
<!-- SETUP GAME -->
<% if @player.game.game_status == -1 %>



<% else %> 

  <!-- SIDEBAR -->
  <div class="col-xs-12 col-sm-3" style="padding:0px;">

    <!-- NAME -->
    <div class="content-container" style="min-height:46px;">
      <div class="panel-primary">
        <div class="panel-title">
          <%= @player.user.name %>
        </div>
      </div>
    </div>

    
    <div class="content-container">

      <div class="panel-group" id="accordion-info" role="tablist" aria-multiselectable="true">
        
        <!-- LINKS -->
        <div class="panel panel-default">
            <div class="panel-secondary" role="tab" >
              <div class="panel-title">
                Apps
              </div>
            </div>
          
          <div id="links" class="panel-collapse" role="tabpanel">
            <div class="panel-body">
              <% @player.teams.each do |team| %>
                <b><%= team.team_name %></b>
                  <% team.projects.sort_by(&:id).each do |project| %>
                    <br>&nbsp;&nbsp;
                    <i class="fa fa-angle-double-right"></i>&nbsp;&nbsp;
                    <a href="#<%= project.project_name %>" aria-controls="<%= project.project_name %>" role="tab" data-toggle="tab" class="primary-a"><%= project.project_name %></a>
                  <% end %>
                <br>
              <% end %>
              <br>
             <!--  <a href="#my_schedule" aria-controls="my_schedule" role="tab" data-toggle="tab" class="primary-a">Work Schedule</a> -->
              <b><%= link_to "Work Calender", player_path(@player), class: "primary-a" %></b>
            </div>
          </div>
        </div>

        <!-- SALARY -->
        <div class="panel panel-default">
            <div class="panel-secondary" role="tab" >
              <div class="panel-title">
                Performance
              </div>
            </div>
          
          <div id="performance" class="panel-collapse" role="tabpanel">
            <div class="panel-body">
              <div class="h-primary"><%= number_to_currency(@player_project_profit, negative_format: "(%u%n)", precision: 0) %></div>
              <h3 class="center">Net Apps Profit (Q<%= @current_quarter-1 %>)</h3>
            </div>
          </div>

          <!-- <div id="performance" class="panel-collapse" role="tabpanel">
            <div class="panel-body">
              <div class="h-primary"><i class="fa fa-usd"></i> <%= @player.salary_total %></div>
              <h3 class="center">Total Salary Earned</h3>
            </div>
          </div> -->

        </div>

        <!-- SKILLS -->
        <div class="panel panel-default">
            <div class="panel-secondary" role="tab" >
              <div class="panel-title">
                Skills
              </div>
            </div>
          
          <div id="skills" class="panel-collapse" role="tabpanel">
            <div class="panel-body">
              
              <% 4.times do |i| %>
                <% level_range = $SKILL_LEVELS.detect { |points,level| level === @player.skill_level[i] }.first %>
                <% skill_progress_ratio = (@player.skill_total_points[i]-level_range.begin)*100/(level_range.end-level_range.begin) %>
                <div class="cpi-goal">  
                  <div class="pull-left" style="margin-left:36px;">
                    <%= $SKILL_NAMES[i] %>
                    <% skill_p = $SKILL_PRODUCTIVITY[i+1][@player.skill_level[i]]*2 %>
                    <% skill_s = $SKILL_SALARY[i+1][@player.skill_level[i]]*2 %>
                    <i class="fa fa-info-circle font-secondary" data-toggle="tooltip" data-placement="top" title="<%= "--- Level #{@player.skill_level[i]} #{$SKILL_NAMES[i]} ---Productivity: #{skill_p} /wk Salary: $#{skill_s} /wk" %>"></i> 
                  </div>
                  <div class="pull-right"><%= @player.skill_total_points[i]-level_range.begin %>
                    <span class="font-secondary">/<%= level_range.end-level_range.begin+1 %></span>
                  </div>
                  <div class="progress-level progress-bar-<%= i+1 %> center"><%= @player.skill_level[i] %></div>
                  <div class="progress">
                    <div class="progress-bar progress-bar-<%= i+1 %>" role="progressbar" aria-valuenow="<%= skill_progress_ratio %>" aria-valuemin="0" aria-valuemax="100" style="width: <%= skill_progress_ratio %>%">
                      <span class="sr-only"><%= skill_progress_ratio %>%</span>
                    </div>
                  </div>
                </div>
              <% end %>

            </div>
          </div>
        </div>

      </div>
    </div>

  </div>

  <!-- MAIN CONTAINER: TABS -->
  <div class="col-xs-12 col-sm-9" style="padding-right:0px;">
    
    <!-- TABS -->
    <div class="tab-content">
      
      <!-- TAB 1: WORK SCHEDULE -->
      <div role="tabpanel" class="tab-pane active" id="my_schedule">
        
        <div class="content-container" style="min-height:46px;">
          <!-- TAB NAME -->
          <div class="panel-primary">
            <div class="panel-title">Work Calender</div>
          </div>
        </div>

        <div class="content-container">
          <%= render "players/work_schedule" %>
        </div>

      </div>

      <!-- TAB 2-N: PROJECTS -->

      <% @player_projects.each do |project| %>
        <div role="tabpanel" class="tab-pane" id="<%= project.project_name %>">
          
          <div class="content-container" style="min-height:46px;">
            <!-- TAB NAME -->
            <div class="panel-primary">
              <div class="panel-title"><%= project.team.team_name %> > App <%= project.project_name %></div>
            </div>
          </div>

          <div class="content-container">
            <div class="panel-secondary">
              <div class="panel-title">
                <%= project.project_name %> :: Beginning <%= get_month_name(@current_month) %> Status 
              </div>
            </div>

            <div class="panel-body" style="padding-bottom:25px;">
              
              <% if @player.game.is_paused %>

                <div class="center h-primary">GAME PAUSED</div>

              <% else %>
                <!-- PERFORMANCE -->
                <div class="col-sm-4 center">
                  <div class="h-primary" style="margin-bottom:27px;">PERFORMANCE</div>

                  <table class="table table-condensed table-hover">
                    
                    <% performance = 0 %>
                    <% project.profit_total.each_with_index do |q_profits,i| %>
                      <tr>
                        <td class="left">Q<%= i+1 %> Expenses</td>
                        <td class="right"><%= number_to_currency(-q_profits[1], negative_format: "(%u%n)", precision: 0) %></td>
                      </tr>

                      <tr>
                        <td class="left">Q<%= i+1 %> Revenue</td>
                        <td class="right"><%= number_to_currency(q_profits[0], negative_format: "(%u%n)", precision: 0) %></td>
                      </tr>
                      
                      <% performance += q_profits[0]-q_profits[1] %>
                    <% end %>
                    <tr>
                      <td class="left"><b>Net Profit</b></td>
                      <td class="right"><b><%= number_to_currency(performance, negative_format: "(%u%n)", precision: 0) %></b></td>
                    </tr>
                  </table>

                </div>

                <!-- STATS -->
                <div class="col-sm-4 center">
                  <div class="h-primary" style="margin-bottom:27px;">Q<%= @current_quarter %> STATS</div>

                  <table class="table table-condensed">
                    <tr>
                      <td class="left">App Unit Price (per Q)</td>
                      <td class="right"><b><%= number_to_currency($PRODUCT_UNIT_COST*4/$GAME_TYPES_LOOKUP[@player.game.game_type][:group_size], precision: 0) %></b></td>
                    </tr>
                    <tr class="">
                      <td class="left">
                        Max User Capacity
                        <i class="fa fa-info-circle font-secondary" data-toggle="tooltip" data-placement="top" title="<%= $HELP_TEXT["max_user_capacity"]%>"></i>
                      </td>
                      <td class="right font-invert progress-bar-1"><b><%= project.stats_total[0] %></b></td>
                    </tr>
                    <tr class="">
                      <td class="left">
                        Demand Generated
                        <i class="fa fa-info-circle font-secondary" data-toggle="tooltip" data-placement="top" title="<%= $HELP_TEXT["demand_generated"]%>"></i>
                      </td>
                      <td class="right font-invert progress-bar-2"><b><%= project.stats_total[1] %></b></td>
                    </tr>
                    <tr class="">
                      <td class="left">
                        Users Supported
                        <i class="fa fa-info-circle font-secondary" data-toggle="tooltip" data-placement="top" title="<%= $HELP_TEXT["users_supported"]%>"></i>
                      </td>
                      <td class="right font-invert progress-bar-3"><b><%= project.stats_total[2] %></b></td>
                    </tr>
                    <tr>
                      <td class="left">
                        <b>Q<%= @current_quarter %> Active Users</b>
                        <i class="fa fa-info-circle font-secondary" data-toggle="tooltip" data-placement="top" title="<%= $HELP_TEXT["active_users"]%>"></i>
                      </td>
                      <td class="right font-invert progress-bar-secondary"><b><%= project.users_total[-1][2] %></b></td>
                    </tr>
                  </table>

                </div>

                <!-- APP R&D -->
                <div class="col-sm-4 center">
                  <div class="h-primary" style="margin-bottom:-9px;">APP R&D CENTER</div>
                  
                  <% 3.times do |i| %>
                  <% stage_no = $RND_STAGES.detect { |points,stage| points === project.rnd_total_points[i] }.last[:stage_no] %>
                    <% stage_range = $RND_STAGES.detect { |points,k| k[:stage_no] === stage_no }.first %>
                    <% rnd_progress_ratio = (project.rnd_total_points[i]-stage_range.begin)*100/(stage_range.end-stage_range.begin) %>
                    <div class="cpi-goal" style="margin-top:30px;">  
                      <div class="pull-left" style="margin-left:36px;">
                        <%= $SKILL_NAMES[i] %>
                      <!--   <i class="fa fa-info-circle font-secondary" data-toggle="tooltip" data-placement="top" title="<%= $HELP_TEXT[i]%>"></i> -->
                      </div>
                      <div class="pull-right"><%= project.rnd_total_points[i]-stage_range.begin %>
                        <span class="font-secondary">/<%= stage_range.end-stage_range.begin+1 %></span>
                      </div>
                      <div class="progress-level progress-bar-secondary center"><%= stage_no %></div>
                      <div class="progress" style="margin-bottom:2px;">
                        <div class="progress-bar progress-bar-4" role="progressbar" aria-valuenow="<%= rnd_progress_ratio %>" aria-valuemin="0" aria-valuemax="100" style="width: <%= rnd_progress_ratio %>%">
                          <span class="sr-only"><%= rnd_progress_ratio %>%</span>
                        </div>
                      </div>
                      <div class="pull-left font-label">
                        <%= $RND_BENEFITS[i] %>: 
                        <% case i %>
                        <% when 0 %>
                        <%= (($RND_STAGES.detect { |points,stage| points === project.rnd_total_points[i] }.last[:multiplier_1])*100).to_i %>%
                        <% when 1 %>
                        <%= (($RND_STAGES.detect { |points,stage| points === project.rnd_total_points[i] }.last[:multiplier_2])*100).to_i %>%
                        <% when 2 %>
                        <%= (($RND_STAGES.detect { |points,stage| points === project.rnd_total_points[i] }.last[:multiplier_3])*100).to_i %>%
                        <% end %>
                      </div>
                    </div>
                  <% end %>

                </div>
              
              <% end %>

            </div>
          
          </div>

          <!-- MEMBERS DETAILS -->
          <% if @player.game.access_treatement and !@player.game.is_paused %>
            <div class="content-container">
              <div class="panel-secondary">
                <div class="panel-title">
                  <%= project.team.team_name %> :: Member's skills
                </div>
              </div>

              <div class="panel-body">

                <table class="table table-condensed table-hover" style="margin:10px 0;">
                  <thead>
                    <tr>
                      <th></th>
                      <% 4.times do |i| %>
                        <th class="center"><%= $SKILL_NAMES[i] %></th>
                      <% end %>
                    </tr>
                  </thead>

                  <tbody>
                    <% project.team.players.each do |p| %>
                      <tr>
                        <td style="padding:15px;">
                          <b><%= p.user.first_name %></b>
                        </td>
                        <% 4.times do |i| %>
                          <% level_range = $SKILL_LEVELS.detect { |points,level| level === p.skill_level[i] }.first %>
                          <% skill_progress_ratio = (p.skill_total_points[i]-level_range.begin)*100/(level_range.end-level_range.begin) %>
                          <td class="col-md-3" style="padding:9px;">
                            <div class="progress-level progress-bar-<%= i+1 %> center" style="line-height: 2; margin: 0 auto; width:<%= 17*p.skill_level[i] %>%"><%= p.skill_level[i] %></div>
                          </td>
                        <% end %>
                    <% end %>
                  </tbody>
                </table>

              </div>

            </div>
          <% end %>


        </div>
      <% end %>

    </div>

  </div>

<% end %>

<script type="text/javascript">
  $(function () {
    $('[data-toggle="tooltip"]').tooltip()
  })
  </script>